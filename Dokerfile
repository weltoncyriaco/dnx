FROM ubuntu:16.04
# Install dependencies
RUN apt-get update
RUN apt-get --assume-yes install apache2
#RUN systemctl start apache2
#RUN systemctl enable apache2
RUN apt-get --assume-yes install php libapache2-mod-php php-mbstring php-cli php-bcmath php-json php-xml php-zip php-pdo php-common php-tokenizer php-mysql
RUN apt-get --assume-yes install composer
# Install app
RUN mkdir /dnx
RUN git clone -b first-challenge https://github.com/DNXLabs/ChallengeDevOps.git /dnx
RUN chmod 777 -R /var/www/
RUN chmod 777 -R /var/www/html/
RUN chmod 777 -R /dnx/
RUN composer install --working-dir=/dnx
RUN rm /var/www/html/*
RUN cp -R /dnx/* /var/www
RUN cp -R /var/www/public/* /var/www/html
# Configure apache
RUN a2enmod rewrite
RUN chown -R www-data:www-data /var/www
ENV APACHE_RUN_USER www-data
ENV APACHE_RUN_GROUP www-data
ENV APACHE_LOG_DIR /var/log/apache2
EXPOSE 80
CMD ["/usr/sbin/apache2", "-D",  "FOREGROUND"]
